"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function toggleFullscreen(e){var t=document.documentElement;e instanceof HTMLElement&&(t=e);var a=document.webkitIsFullScreen||document.mozFullScreen||!1;t.requestFullScreen=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen||function(){return!1},document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||function(){return!1},a?document.exitFullscreen():t.requestFullScreen()}var _createClass=function(){function s(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,a){return t&&s(e.prototype,t),a&&s(e,a),e}}(),firstmoji=twemoji.parse("ðŸ¥‡"),secondmoji=twemoji.parse("ðŸ¥ˆ"),thirdmoji=twemoji.parse("ðŸ¥‰"),memoji=["ðŸ˜‘","ðŸ˜€","ðŸ˜—","ðŸ˜","ðŸ§","ðŸ¤“","ðŸ•µï¸â€â™‚ï¸"],MessageBox=function(e){function t(e){_classCallCheck(this,t);var l=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return l.setOwner=function(e){l.setState({owner:e})},l.handleMessage=function(e,t){var a=t?e.to:e.from;l.state.messages[a]||(l.state.messages[a]=[]),l.state.messages[a].push(e),l.setState({messages:l.state.messages})},l.handleInputChange=function(e){var t=e.target,a="checkbox"===t.type?t.checked:t.value,s=t.name;l.setState(_defineProperty({},s,a))},l.messageBox=function(){var e=[],t=Object.keys(l.state.messages);if(0==t.length)return[];var a=l.state.username||t[0];if(l.state.messages[a])for(var s=0;s<l.state.messages[a].length;s++){var n=l.state.messages[a][s],o=n.to==l.state.owner,r="msg-outbound",c="To: "+n.to;o&&(r="msg-inbound",c="From: "+n.from);var i=React.createElement("span",{className:"uk-label uk-margin-small-left uk-margin-small-right"},c);e.push(React.createElement("div",{className:r,key:s},o?"":i,React.createElement("div",{className:"msg-wrapper uk-margin-small-top"},n.text),o?i:""))}return e},l.loginDialog=function(){var e=React.createElement("div",{className:"uk-alert-danger uk-padding","uk-alert":!0},React.createElement("a",{className:"uk-alert-close","uk-close":!0}),"You still need to ",React.createElement("a",{className:"uk-link-reset",href:"/signin"},React.createElement("u",null,"login")),"."),t=React.createElement("span",{className:"uk-label"},"Logged in as ",l.state.owner);return null===l.state.owner?e:t},l.connectMessage=function(){l.socket.emit("open message",l.setOwner)},l.switchDialog=function(){for(var e=[],t="",a=Object.keys(l.state.messages),s=0;s<a.length;s++){var n=a[s];""==t&&(t=n),e.push(React.createElement("option",{key:"msgr-"+n,value:n},n))}var o=l.props.contacts||[];for(s=0;s<o.length;s++){var r=o[s];""==t&&(t=r),r!=l.state.owner&&a.indexOf(r)<0&&e.push(React.createElement("option",{key:"msgr-"+r,value:r},r))}return 0<e.length?(""==l.state.username&&(l.state.username=t),React.createElement("select",{className:"uk-select",name:"username",onChange:l.handleInputChange,value:l.state.username},e)):React.createElement("input",{className:"uk-input uk-margin-small-top uk-margin-small-bottom",type:"text",name:"username",onChange:l.handleInputChange,value:l.state.username,placeholder:"Username"})},l.sendMessage=function(){var t={event:0,from:l.state.owner,to:l.state.username,text:l.state.message,date:null};l.socket.emit("send message",l.state.username,l.state.message,function(e){t.date=Date.now(),l.handleMessage(t,!0)}),l.setState({message:""})},l.toggle=function(){l.setState({open:!l.state.open})},l.state={username:"",message:"",messages:{},owner:"",open:!1},l.handleInputChange=l.handleInputChange.bind(l),l.socket=io.connect(window.location.origin+"/chat"),l.socket.on("receive message",l.handleMessage),$("#main-container").removeClass("uk-container"),l.connectMessage(),l}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"float-chat"+(this.state.open?" open":"")},React.createElement("button",{className:"float-chat-icon uk-icon-button",onClick:this.toggle,"uk-icon":"comments"}),React.createElement("div",{className:"msg-box uk-card uk-card-secondary uk-card-body"},React.createElement("button",{className:"float-chat-close uk-icon-button uk-float-right",onClick:this.toggle,"uk-icon":"shrink"}),this.loginDialog(),React.createElement("div",{className:"uk-margin"},this.messageBox()),React.createElement("div",null,this.switchDialog(),React.createElement("textarea",{className:"uk-textarea uk-margin",onChange:this.handleInputChange,placeholder:"Message",name:"message",value:this.state.message})),React.createElement("button",{onClick:this.sendMessage,className:"uk-button uk-button-primary"},"Send")))}}]),t}(),SpyfallTimer=function(e){function s(e){_classCallCheck(this,s);var t=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));t.radius=0,t.componentDidMount=function(){t.radius=t.props.radius,t.started=Date.parse(t.props.started),t.setupTick()},t.componentDidUpdate=function(){t.started=Date.parse(t.props.started),t.running||t.setupTick()},t.setupTick=function(){t.circumference=2*Math.PI*t.props.radius,t.running=!0,t.tick()},t.tick=function(){t.count=Math.floor((t.started-Date.now())/t.props.interval)+t.props.length,0<t.count&&t.running?setTimeout(t.tick,t.props.interval/t.props.checkframes):t.running=!1,t.update()},t.update=function(){var e=t.props.length-t.count;t.Ecircle&&t.Etext&&($(t.Ecircle.current).css("stroke-dasharray",e*t.circumference/t.props.length+" "+t.circumference),$(t.Etext.current).html(0<t.count?t.count:0))},t.props=e,t.count=0,t.Ecircle=React.createRef(),t.Etext=React.createRef(),t.running=!1;var a=t;return $(window).resize(function(){a.forceUpdate()}),t}return _inherits(s,React.Component),_createClass(s,[{key:"render",value:function(){var e=640<window.innerWidth?this.props.radius:.7*this.props.radius,t=e+e;return React.createElement("div",{hidden:this.props.hidden,className:"round-timer-wrap"},React.createElement("svg",{className:"round-timer-circle",width:t,height:t},React.createElement("circle",{className:"round-timer-sector",ref:this.Ecircle,style:{strokeWidth:t},r:e,cx:e,cy:e}),React.createElement("circle",{className:"round-timer-bg",r:.65*e,cx:e,cy:e})),React.createElement("span",{className:"round-timer-text",ref:this.Etext,style:{top:e+"px",left:e+"px"}}))}}]),s}(),SpyfallProgressTimer=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.componentDidMount=function(){t.radius=t.props.radius,t.setupTick()},t.componentDidUpdate=function(){t.started=Date.parse(t.props.started),t.running||t.setupTick()},t.setupTick=function(){t.circumference=2*Math.PI*t.props.radius,t.running=!0,t.tick()},t.tick=function(){t.count=Math.floor((t.started-Date.now())/t.props.interval)+t.props.length,0<t.count&&t.running?setTimeout(t.tick,t.props.interval/t.props.checkframes):t.running=!1,t.update()},t.update=function(){var e=t.count/t.props.length;e=Math.max(0,Math.min(1,e)),t.bar&&$(t.bar.current).css("width",100*e+"%")},t.count=0,t.running=!1,t.bar=React.createRef(),t.started=Date.parse(e.started),t}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{hidden:this.props.hidden,className:"prog-timer-bg"},React.createElement("div",{ref:this.bar,className:"prog-timer-bar"}))}}]),a}(),SpyfallMessageBox=function(e){function t(e){_classCallCheck(this,t);var c=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return c.lastMessagesLength=0,c.lastType="",c.componentDidMount=function(){c.scroller&&c.scroller.scrollIntoView(),c.lastMessagesLength=c.props.messages.length,c.lastType=c.props.type},c.componentDidUpdate=function(e,t){c.lastMessagesLength==c.props.messages.length&&c.lastType==c.props.type||c.scroller&&c.scroller.scrollIntoView()},c.qaBox=function(){for(var e=[],t=0;t<c.props.messages.length;t++){var a=c.props.messages[t],s=a.fromUsername==c.props.username?"You":a.fromUsername,n=a.toUsername==c.props.username?"You":a.toUsername;e.push(React.createElement("div",{className:"uk-margin-medium-bottom",key:"qa-"+t},React.createElement("span",{className:"game-qa-talk"},React.createElement("div",{className:"game-qa-talk-q"},React.createElement("span",{className:"game-talk-person"},s),a.question),React.createElement("div",{className:"game-qa-talk-a"},React.createElement("span",{className:"game-talk-person"},n),a.answer?a.answer:React.createElement("div",{className:"lds-ellipsis-chat"},React.createElement("div",null),React.createElement("div",null),React.createElement("div",null),React.createElement("div",null))))))}return 0==e.length?e.push("No Messages :'("):e.push(c.Escroll),e},c.discussBox=function(){for(var e=[],t=0;t<c.props.messages.length;t++){var a=c.props.messages[t],s=a.fromUsername!=c.props.username,n="msg-outbound",o="",r="";s&&(n="msg-inbound",o="From: "+a.fromUsername,r=React.createElement("span",{className:"uk-label uk-margin-small-left uk-margin-small-right"},o)),e.push(React.createElement("div",{className:n,key:"discuss-"+t},React.createElement("div",{className:"msg-wrapper uk-margin-small-top"},a.message),s&&r))}return 0==e.length?e.push("No Messages :'("):e.push(c.Escroll),e},c.messagebox=React.createRef(),c.Escroll=React.createElement("div",{key:"scroller",ref:function(e){return c.scroller=e}}),c}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var e=this.props.title?this.props.title:"Q & A";return React.createElement("div",{className:"game-box dir-c grow scroll"},React.createElement("div",{ref:this.messagebox,className:"game-messages uk-card uk-card-body uk-card-hover uk-text-center grow type-"+this.props.type},React.createElement("div",{className:"uk-margin-bottom uk-text-bold"},e),"qa"==this.props.type?this.qaBox():this.discussBox()))}}]),t}(),SpyfallProfileIcon=function(e){function t(e){_classCallCheck(this,t);var s=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.componentDidUpdate=function(e,t){if(s.crntReact!=s.props.data.reaction){var a=$(s.reactref.current);a.hasClass("show")&&a.removeClass("show"),a.toggleClass("show",200,"easeOutSine"),s.crntReact=s.props.data.reaction}},s.crntReact=e.data.reaction,s.reactref=React.createRef(),s}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){this.props.identifier;var e=this.props.username,t=this.props.data,a=e?(e.charAt(0)+"").toUpperCase():"_",s=memoji[t.reaction],n=twemoji.parse(s||memoji[0]),o=this.props.isPlayer||!1,r=t.connected,c=this.props.position||"right-center",i=this.props.extra||!1;return React.createElement("div",{className:"player-profile uk-text-center "+this.props.className,key:e,"data-username":e},React.createElement("div",{className:"player-avatar"+(o?" player-user":"")+(r?" connected":"")},React.createElement("div",{className:"player-label"},a)),React.createElement("div",{"uk-drop":"pos: "+c},React.createElement("div",{className:"uk-card uk-card-body uk-card-default"},!o&&React.createElement("div",{className:"player-meta uk-margin-small-bottom"},React.createElement("div",{className:"uk-text-meta"},"Player Username"),React.createElement("div",{className:"uk-text-lead uk-text-bold"},e)),!this.props.open&&React.createElement("div",null,React.createElement("div",{className:"uk-text-meta"},o?"Your":"Player"," Score"),React.createElement("div",{className:"uk-text-lead uk-text-bold"},t.score)),o&&React.createElement("div",{className:"uk-flex uk-flex-center uk-flex-wrap"},this.props.reactButtons),i)),React.createElement("div",{ref:this.reactref,className:"player-reaction",dangerouslySetInnerHTML:{__html:n}}))}}]),t}(),SpyfallGameBox=function(e){function a(e){_classCallCheck(this,a);var h=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));h.componentDidMount=function(){h.socket.emit("whoami game",function(e){h.setState({username:e,checkedin:!0})})},h.establish=function(){h.socket&&h.socket.connected||(h.socket&&h.socket.socket?h.socket.socket.connect():h.socket=io.connect(window.location.origin+"/game"))},h.makeAnnouncement=function(e,t,a){if(!h.announcing){var s=$("#spyfall-game-ui-overlay-content"),n=$("#spyfall-game-ui-overlay"),o=twemoji.parse(e),r=React.createElement("div",{className:"overlay-box uk-text-center"},React.createElement("div",{className:"overlay-icon",dangerouslySetInnerHTML:{__html:o}}),React.createElement("h2",{className:"overlay-title uk-text-bold no-margin"},t),React.createElement("p",{className:"overlay-description"},a));h.announcing=!0,ReactDOM.render(r,s[0]),n.show(),$("#main-container").addClass("overlay-mode",500),setTimeout(h.closeAnnouncement,2e3)}},h.closeAnnouncement=function(){var e=$("#main-container"),t=$("#spyfall-game-ui-overlay");e.removeClass("overlay-mode",500,function(){t.hide(),h.announcing=!1})},h.createReactionModule=function(){for(var t=[],e=function(){var e=a;t.push(React.createElement("button",{className:"uk-button uk-button-default uk-button-small",onClick:function(){return h.reactGame(e)},key:"emoji-"+a,dangerouslySetInnerHTML:{__html:twemoji.parse(memoji[a])}}))},a=0;a<memoji.length;a++)e();h.reactButtons=t},h.displayError=function(e){console.log(e),e?UIkit.notification({message:e.message?e.message:"Server did not accept inputs.",pos:"top-center"}):UIkit.notification({message:"Server denied your request."})},h.socketHandlers=function(){h.socket.on("round_start game",function(e){h.setState({asked:!1,discussion:[],game:{role:"",location:""},hasAccused:[],initiated:!1,input:!1,messages:[],number:h.state.number+1,phase:0,spyGuessed:!1,timerDelta:0,timerStarted:e,timeoutStarted:e,victory:null,votedBy:"",votes:{},votingFor:""})}),h.socket.on("question_asked game",function(e){var t=h.state.messages.concat(e);h.setState({messages:t})}),h.socket.on("answer_replied game",function(e){if(h.state.messages){var t=h.state.messages.length;h.state.messages[t-1].answer=e.answer,h.setState({messages:h.state.messages})}}),h.socket.on("reacted game",function(e,t){h.state.players[e].reaction=t,h.setState({players:h.state.players,updateEmoji:e})}),h.socket.on("player_joined game",function(e){h.state.players[e]={score:0,reaction:0},h.setState({players:h.state.players})}),h.socket.on("started game",function(){h.setState({open:!1})}),h.socket.on("initiated game",function(e){e&&h.setState({spyGuessed:!0})}),h.socket.on("change_phase game",function(e){h.makeAnnouncement("ðŸš€",h.phases[e],"The phase has changed."),h.setState({phase:e})}),h.socket.on("victory game",function(e){h.makeAnnouncement("ðŸ†",1==e||4==e?"Spy Wins":"Non-spies win",["Spy guessed the location correctly.","Spy guessed the location incorrectly.","Non-spies guessed the spy correctly.","Non-spies guessed the spy incorrectly."][e])}),h.socket.on("ended game",function(){console.log("DIE")}),h.socket.on("force_reload game",function(){h.connectGame()}),h.socket.on("update_players game",function(e){h.setState({players:e})}),h.socket.on("votes_succeed game",function(){h.setState({votedBy:"",votingFor:"",votes:{}})}),h.socket.on("votes_failed game",function(){h.makeAnnouncement("ðŸ˜°",h.state.votedBy+" has failed to accuse "+h.state.votingFor,"The game shall continue."),h.setState({votedBy:"",votingFor:"",votes:{}})}),h.socket.on("has_voted game",function(e,t){var a=h.state.votes;a[e]=t,h.setState({votes:a})}),h.socket.on("take_votes game",function(e,t,a){h.setState({timeoutStarted:a,votedBy:e,votingFor:t,votes:{}})}),h.socket.on("take_question game",function(e,t){e!=h.state.username&&h.makeAnnouncement("ðŸ§",e+" shall ask someone.","Prepare yourself to be asked."),h.setState({timeoutStarted:t,input:e,asked:!1})}),h.socket.on("take_answer game",function(e,t){h.setState({timeoutStarted:t,input:e,asked:!0})}),h.socket.on("round_end game",function(e,t,a,s){var n=h.state.game;n.endgame={spy:t,location:e,roles:a},h.setState({game:n,victory:s})}),h.socket.on("discussed game",function(e,t){h.state.discussion.push({fromUsername:e,message:t}),h.setState({discussion:h.state.discussion})}),h.socket.on("is_waiting game",function(e){h.setState({timeoutStarted:e})}),h.socket.on("user_connected game",function(e){console.log(e,"connected"),h.state.players[e].connected=!0,h.setState({players:h.state.players})}),h.socket.on("user_disconnected game",function(e){h.state.players[e].connected=!1,h.setState({players:h.state.players})}),h.socket.on("give_role game",function(e){h.setState({game:e})}),h.socket.on("take_location game",function(){h.makeAnnouncement("ðŸ—º","Identify your best guess of the location.","Find clues in your conversation with the non-spies."),console.log("Timer Running")}),h.socket.on("take_suspicion game",function(){h.makeAnnouncement("ðŸ‘","Identify your best guess of the spy.","Whom do you think it is?"),h.setState({votedBy:h.state.username})})},h.handleInputChange=function(e){var t=e.target,a="checkbox"===t.type?t.checked:t.value,s=t.name;h.setState(_defineProperty({},s,a))},h.handleLocationPick=function(e){if(2!=h.state.phase||"spy"!=h.state.game.role)return!1;console.log("Check Loc: "+e),h.socket.emit("location game",h.state.roomcode,e,function(e){console.log("Location Correct: "+e)})},h.reactGame=function(a){h.socket.emit("react game",h.state.roomcode,a,function(e){if(1!=e)return h.displayError(e);var t=h.state.players;h.state.players[h.state.username].reaction=a,h.setState({players:t,updateEmoji:h.state.username})})},h.startGame=function(){var e=h.state.roomcode+"";h.socket.emit("start game",e,function(e){if(1!=e)return h.displayError(e);h.setState({open:!1})})},h.newGame=function(){var e=h.state.roomcode+"";h.socket.emit("new game",e,function(e){if(1!=e)return h.displayError(e)})},h.promptConnect=function(){var e=$("#spyfall-game-prompt").addClass("loaded");$("#spyfall-game-prompt-title").html("Do you want to try to join this game?");var t=React.createElement("div",{className:"uk-text-center"},React.createElement("p",null,"If the game exists and hasn't started yet it may be possible."),React.createElement("button",{className:"uk-button uk-button-primary",onClick:function(){e.removeClass("loaded"),$.ajax({type:"POST",url:"/api/join",data:{webapp:!0,room:h.state.roomcode},success:function(){UIkit.modal(e[0]).hide(),h.makeAnnouncement("ðŸ˜Ž","Success","You joined the game."),h.connectGame()},error:function(){UIkit.modal(e[0]).hide(),h.makeAnnouncement("ðŸ˜±","Fail","You can't join the game.")}})}},"Try it"));ReactDOM.render(t,$("#spyfall-game-prompt-content")[0]),UIkit.modal(e[0]).show()},h.connectGame=function(t){var a=h.state.roomcode+"";h.socket.emit("load game",a,function(e){if(0==e)return h.displayError(e),void(t&&h.promptConnect());console.log(e),h.setState(e),h.socket.emit("open game",a,function(e){if($("html").css("font-size","0"),1!=e)return h.displayError(e);h.setState({connected:!0}),$("html").css("font-size","")})})},h.closeGame=function(){},h.initiateGame=function(){var e=h.state.roomcode+"";h.socket.emit("initiate game",e,function(e){if(1!=e)return h.displayError(e);h.setState({initiated:!0})})},h.suspectGame=function(){var e=h.state.roomcode+"";h.socket.emit("suspect game",e,h.state.votingFor,function(e){if(1!=e)return h.displayError(e)})},h.voteGame=function(t){var e=h.state.roomcode+"";h.socket.emit("vote game",e,t,function(e){if(1!=e)return h.displayError(e);h.state.votes[h.state.username]=t,h.setState({votes:h.state.votes})})},h.discussGame=function(){var e=h.state.roomcode+"",t=h.state.text;h.socket.emit("discuss game",e,t,function(e){if(1!=e)return h.displayError(e);h.state.discussion.push({fromUsername:h.state.username,message:t}),h.setState({discussion:h.state.discussion,text:""})})},h.sendQuery=function(){if(h.state.input===h.state.username){var e=h.state.roomcode+"";if(h.state.asked){var s=h.state.text+"";s&&h.socket.emit("answer game",e,s,function(e){if(1!=e)return h.displayError(e);var t=h.state.messages.length;if(!0===e&&0!=t){var a=h.state.messages.length;h.state.messages[a-1].answer=s,h.setState({messages:h.state.messages,text:""})}})}else{var n=h.state.text+"",o=h.state.target;n&&h.socket.emit("question game",e,o,n,function(e){if(1!=e)return h.displayError(e);var t={fromUsername:h.state.username,toUsername:o,question:n,answer:null},a=h.state.messages.concat(t);h.setState({messages:a,input:null,text:""})})}}},h.targetBox=function(){var e=[],t=null;if(3!=h.state.phase){var a=h.state.messages;0!=a.length&&(t=a[a.length-1].fromUsername)}for(var s=Object.keys(h.state.players),n=0;n<s.length;n++){var o=s[n];o!=h.state.username&&o!=t&&e.push(React.createElement("option",{key:o,value:o},o))}var r=3==h.state.phase;return React.createElement("select",{className:"uk-select",name:r?"votingFor":"target",onChange:h.handleInputChange,value:r?h.state.votingFor:h.state.target},React.createElement("option",{value:null},"-- Select One --"),e)},h.inputBox=function(){var e=h.state.phase,t=void 0!==h.state.votes[h.state.username],a={normal:0==e,voting:3==e,spyguesses:2==e,finding:2==e&&"spy"==h.state.game.role,setvote:3==e&&h.state.votedBy==h.state.username,questioning:0==e&&h.state.input==h.state.username&&!h.state.asked,asked:h.state.asked,discuss:4==e||1==e,discussvoting:4==e&&h.state.votingFor,queried:0==e&&h.state.input==h.state.username,compliance:4==e&&h.state.username!=h.state.votingFor&&h.state.username!=h.state.votedBy};return React.createElement("div",{className:"game-input-box uk-margin-small-top no-shrink"},(a.normal||a.setvote)&&React.createElement("div",{className:"uk-padding-small"},React.createElement("b",null,a.setvote||a.queried?"You":a.normal?h.state.input:"Someone")," will ",React.createElement("b",null,a.setvote?"vote":a.asked?"answer":"question"),"."),a.spyguesses&&!a.finding&&React.createElement("div",{className:"uk-padding-small"},"The spy is guessing for the location."),a.voting&&!a.setvote&&React.createElement("div",{className:"uk-padding-small"},"Someone is guessing for the spy's identity."),a.discussvoting&&React.createElement("div",{className:"uk-padding-small"},React.createElement("b",null,h.state.votedBy)," accuses ",React.createElement("b",null,h.state.votingFor)," as the Spy!"),(a.setvote||a.questioning)&&h.targetBox(),(a.queried||a.discuss)&&React.createElement("input",{className:"uk-input uk-margin-small-top uk-margin-small-bottom",type:"text",name:"text",onChange:h.handleInputChange,value:h.state.text,placeholder:a.queried?a.asked?"Answer":"Question":"Discuss"}),(a.queried||a.setvote||a.discuss)&&React.createElement("button",{onClick:h.defaultAction(),className:"uk-button uk-button-secondary uk-margin-small-top uk-margin-small-bottom"},a.queried?a.asked?"Reply":"Ask":a.voting?"Vote":"Send"),a.compliance&&React.createElement("span",{className:"uk-margin-small-top uk-margin-small-bottom uk-display-inline-block"},React.createElement("button",{onClick:function(){h.voteGame(!0)},disabled:t,className:"uk-button uk-button-secondary uk-margin-left"},"Agree"),React.createElement("button",{onClick:function(){h.voteGame(!1)},disabled:t,className:"uk-button uk-button-secondary uk-margin-small-left"},"Disagree")))},h.defaultAction=function(){var e=h.state.phase;return h.state.connected?0==e&&h.state.input==h.state.username?h.sendQuery:3==e&&h.state.votedBy==h.state.username?h.suspectGame:h.discussGame:h.connectGame},h.toggleMessageBox=function(){h.setState({toggleMessages:3<=h.state.toggleMessages+1?0:h.state.toggleMessages+1})},h.roleBox=function(){var e=[],t=[],a=0,s=1==h.state.phase,n=h.state.username;if(s){if(!h.state.game.endgame)return"";var o=h.state.game.endgame,r=h.state.number<h.state.rounds;if(e.push("Location is the ",React.createElement("i",{key:"role-"+a++},o.location)),t.push(React.createElement("b",{key:"role-"+a++},o.spy)," is the Spy! "),Object.keys(o.roles).forEach(function(e){n==e?t.push("You are"):t.push(React.createElement("b",{key:"role-"+a++},e)," is"),t.push(" the "+o.roles[e]+". ")}),!r){var c;e.push(". "),(c=e).push.apply(c,_toConsumableArray(t)),t=e;for(var i="",l=!1,m=h.state.players,u=Object.keys(m),d=0;d<u.length;d++){var p=u[d];-1<m[p].score?i=p:-1==m[p].score&&(l=!0,i+=" & "+p)}e=[(l||n!=i?i:"You")+" "+(l||n==i?"are":"is")+" the winner!"]}}else{var g="spy"==h.state.game.role;e=[0<h.state.number?"You are the "+(g?"Spy":h.state.game.role)+"!":"Waiting for GM"],t=[0<h.state.number?g?"":React.createElement("div",{key:"role-"+a++},"The location is the ",h.state.game.location,"."):"The game master will dictate the start of the game."]}return React.createElement("div",{id:"game-role-box-"+h.props.identifier,className:"game-role-box game-stretch uk-padding-small"},React.createElement("h2",{className:"uk-text-bold no-margin"},e),t)},h.playersBox=function(){h.state.updateEmoji;h.state.updateEmoji="";for(var e=[],t=h.state.players,a=Object.keys(t),s=h.props.identifier,n=h.state.open,o=h.reactButtons,r=0;r<a.length;r++){var c=a[r];c!=h.state.username&&e.push(React.createElement(SpyfallProfileIcon,{data:t[c],username:c,isplayer:!1,key:s+"-"+c,identifier:s,open:n,reactButtons:o}))}return e},h.messageBox=function(){var e=0==h.state.toggleMessages&&(0==h.state.phase||3==h.state.phase)||1==h.state.toggleMessages&&(1==h.state.phase||4==h.state.phase)||2==h.state.toggleMessages&&2==h.state.phase,t=0==h.state.toggleMessages&&(1==h.state.phase||4==h.state.phase)||1==h.state.toggleMessages&&(0==h.state.phase||2==h.state.phase||3==h.state.phase),a=(2==h.state.toggleMessages||0==h.state.toggleMessages&&h.state.phase,"");if(e&&h.state.messages)a=React.createElement(SpyfallMessageBox,{className:"grow-h game-box",identifier:h.props.identifier,username:h.state.username,messages:h.state.messages,type:"qa",title:"Q & A"});else if(t)a=React.createElement(SpyfallMessageBox,{className:"grow-h game-box",identifier:h.props.identifier,username:h.state.username,messages:h.state.discussion,type:"discuss",title:"Discussion"});else{for(var s=[],n=h.state.locations,o="spy"==h.state.game.role,r=function(){var e=n[c],t=e==h.state.game.location;s.push(React.createElement("span",{key:"location-"+e},React.createElement("button",{onClick:function(){return h.handleLocationPick(e)},disabled:!o&&!t,"data-location":e,className:"uk-button uk-button-small uk-button-primary"},e))),s.push(" ")},c=0;c<n.length;c++)r();a=React.createElement("div",{className:"game-box dir-c grow scroll"},React.createElement("div",{className:"game-messages grow-h uk-text-center uk-text-break game-locations uk-padding uk-card uk-card-body scroll grow"},React.createElement("h2",null,"Locations"),s))}return a},h.menuBox=function(){return React.createElement("button",{onClick:h.showMenu,className:"uk-button uk-button-primary uk-margin-small-top uk-width-1-1"},"Menu")},h.showMenu=function(){UIkit.offcanvas($("#offcanvas-overlay")).show()},h.renderGameList=function(){var o=$("#spyfall-game-prompt").removeClass("loaded"),r=$("#spyfall-game-prompt-content");$("#spyfall-game-prompt-title").html("Games you're in");UIkit.modal(o[0]).show(),h.socket.emit("available game",function(e){for(var a=[],t=function(){var t=e[s];a.push(React.createElement("a",{className:"uk-badge uk-margin-small-right",key:"game-list"+s,onClick:function(){return e=t.id,h.state.roomcode=e,h.connectGame(),void UIkit.modal(o[0]).hide();var e}}," ",t.id," "))},s=0;s<e.length;s++)t();var n=React.createElement("div",null,a||"No games joined.");ReactDOM.render(n,r[0]),o.addClass("loaded")})},h.phases=["Question & Answer Phase","Discussion Phase","The spy is guessing.","Suspicion Phase","Voting Phase"],h.state={console:null,checkedin:!1,connected:!1,roomcode:"",target:"",text:"",updateEmoji:"",toggleMessages:0,asked:!0,deck:"",discussion:[],game:{role:"",location:""},hasAccused:[],initiated:!1,input:!1,locations:[],master:!1,messages:[],number:0,open:!0,phase:0,players:{},roundLength:540,rounds:8,spyGuessed:!1,timerStarted:"",timerDelta:0,timeoutStarted:null,timeoutLength:30,username:null,victory:null,votedBy:"",votes:{},votingFor:""};var t=h;return document.addEventListener("keydown",function(e){13!=e.keyCode&&13!=e.which||!e.altKey?13!=e.keyCode&&13!=e.which||t.defaultAction()():toggleFullscreen()},!1),$(window).focus(function(){h.socket.disconnected&&h.state.roomcode&&(h.establish(),h.connectGame())}),h.handleInputChange=h.handleInputChange.bind(h),h.handleLocationPick=h.handleLocationPick.bind(h),h.establish(),h.socketHandlers(),$("#spyfall-game-ui-overlay").click(h.closeAnnouncement),h.createReactionModule(),h}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){var e=this,t="url('/decks/"+encodeURIComponent(this.state.deck)+"/"+encodeURIComponent(this.state.game.location)+".jpg')",a="url('/decks/"+encodeURIComponent(this.state.deck)+"/default.jpg')",s="spy"==this.state.game.role,n=this.state.username;return React.createElement("div",{className:"backdrop game-stretch",style:s?{background:a}:this.state.game.location?{background:t}:{}},React.createElement("div",{className:"game-box game-fadedrop game-stretch grow-h uk-padding"},this.state.connected?React.createElement("div",{className:"game-box dir-c grow"},React.createElement("div",{className:"game-box no-shrink"},React.createElement("div",{className:"grow uk-position-relative uk-margin-small-right"},React.createElement("div",{className:"game-actions-wrap uk-position-relative"},this.roleBox())),React.createElement("div",{className:"game-box no-shrink"},React.createElement("div",null,React.createElement("div",{className:"uk-position-relative game-actions-wrap"},React.createElement("button",{className:"uk-button uk-button-primary game-initiate",disabled:this.state.initiated||0<=this.state.hasAccused.indexOf(n),onClick:this.initiateGame},"Initiate ","spy"==this.state.game.role?"Guess":"Suspicion"),React.createElement("button",{className:"uk-button uk-button-secondary game-toggler",onClick:this.toggleMessageBox},"Toggle View"))),React.createElement("div",{className:"game-box no-shrink game-flex-center",key:"menu"},React.createElement(SpyfallProfileIcon,{data:this.state.players[n],username:n,isplayer:!1,identifier:this.props.identifier,key:this.props.identifier+"-"+n,open:this.state.open,isPlayer:!0,reactButtons:this.reactButtons,extra:this.menuBox()})))),React.createElement("div",{className:"game-box grow uk-margin-left"},React.createElement("div",{className:"player-box uk-margin-small-right"},React.createElement("div",{className:"game-stretch"},React.createElement("div",{className:"game-box game-stretch grow dir-c"},React.createElement("div",{className:"grow scroll"},this.playersBox())))),React.createElement("div",{className:"game-box dir-c grow uk-position-relative"},!this.state.open&&React.createElement("div",{className:"game-box grow dir-c uk-position-relative"},React.createElement("div",{className:"round-timer-position-wrap"},React.createElement(SpyfallTimer,{hidden:1==this.state.phase,radius:30,identifier:this.props.identifier,interval:1e3,length:this.state.timeoutLength,started:this.state.timeoutStarted,checkframes:3})),this.messageBox(),React.createElement(SpyfallProgressTimer,{hidden:1==this.state.phase,length:this.state.roundLength,started:this.state.timerStarted,interval:1e3,checkframes:3}),this.inputBox()),this.state.master&&(this.state.open||1==this.state.phase)&&React.createElement("button",{onClick:this.state.number<this.state.rounds?0==this.state.number?this.startGame:this.newGame:this.closeGame,className:"uk-button "+(this.state.number<this.state.rounds?"uk-button-primary":"uk-button-danger")},this.state.number<this.state.rounds?0==this.state.number?"Start":"Proceed":"Close"),React.createElement("div",{className:"uk-text-right uk-text-meta uk-margin-small"},React.createElement("a",{onClick:this.connectGame},"Reload")," | ",React.createElement("a",{className:"",onClick:toggleFullscreen},"Toggle Fullscreen")," | User: ",React.createElement("code",null,n)," | Room: ",React.createElement("code",null,this.state.roomcode))))):React.createElement("div",{className:"game-box dir-c grow-w game-box-center"},React.createElement("div",{style:{minWidth:"360px"}},this.state.checkedin?React.createElement("div",null,React.createElement("div",{className:"uk-navbar-item uk-logo"},"spyfall.chat"),!this.state.username&&React.createElement("div",{className:"uk-alert-danger uk-padding-small"},"You may need to ",React.createElement("a",{href:"/signin"},"sign in"),"."),React.createElement("input",{className:"uk-input uk-margin",type:"text",onChange:this.handleInputChange,placeholder:"Room Code",name:"roomcode",value:this.state.roomcode}),React.createElement("button",{onClick:function(){return e.connectGame(!0)},className:"uk-button uk-button-primary uk-width-1-1"},"Connect")):React.createElement("div",{className:"uk-text-center"},React.createElement("div",{className:"uk-margin-small-bottom"},"Checking You In..."),React.createElement("div",{className:"lds-ripple"},React.createElement("div",null),React.createElement("div",null))),this.state.username&&React.createElement("button",{onClick:this.renderGameList,className:"uk-button uk-button-secondary uk-margin-small-top uk-width-1-1"},"List"),React.createElement("button",{onClick:this.showMenu,className:"uk-button uk-button-secondary uk-margin-small-top uk-width-1-1"},"Menu")))),React.createElement(MessageBox,{contacts:Object.keys(this.state.players)}))}}]),a}();
//# sourceMappingURL=client-components.js.map